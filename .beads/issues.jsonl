{"id":"canopy-0bi","title":"Refactor service.cpp for better maintainability","description":"Refactor complex functions in service.cpp to improve maintainability and testability.\n\nStatus: PLANNED\n\nTarget Functions:\n1. check_is_empty() Decomposition\n   - Does too many things (logging, state verification, resource cleanup)\n   - Complex control flow with multiple responsibilities\n   - Hard to test in isolation\n   \n   Proposed:\n   - Extract logging logic\n   - Create dedicated state verification function\n   - Separate resource cleanup concerns\n\n2. release() Simplification\n   - Nested scopes with complex lock management\n   - Intricate logic for handling optimistic referencing\n   - Difficult to understand control flow\n   \n   Proposed:\n   - Extract optimistic reference handling\n   - Reduce nesting depth through early returns\n   - Document state transitions\n   - Create unit tests for each code path\n\nBenefits:\n- Easier to understand and maintain\n- Better testability\n- Reduced risk of bugs in complex logic\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md (Section 3.1)\nLocation: rpc/src/service.cpp","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":640,"created_at":"2026-01-12T14:28:36.366181836Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.523007714Z","labels":["code-quality","refactoring"]}
{"id":"canopy-17e","title":"Test command for validation","description":"# Test Command\n\nRun this to validate visualization changes:\n\n```bash\ncd /home/edward/projects/Canopy/build_debug\n./output/rpc_test --telemetry-animation --gtest_filter=remote_type_test/0.check_unknown_zone_reference_path\n```\n\nThis will:\n1. Run the specific test case\n2. Generate telemetry HTML file\n3. Can open in browser to verify visualization\n\nOutput location: `rpc_test_diagram/remote_type_test#0/check_unknown_zone_reference_path.html`","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:39:12.203759489Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T22:39:12.203759489Z"}
{"id":"canopy-1yo","title":"Formalize IDL type system with explicit types","description":"Formalize the Canopy IDL type system with explicit type definitions, eliminating platform ambiguity.\n\nStatus: PLANNED - HIGH IMPACT FOUNDATIONAL WORK\n\nCurrent Problem:\n- Types like int, long, size_t have platform-dependent sizes\n- Poor type safety in generators (string-based type parsing)\n- Limited metaprogramming capabilities\n- Unclear RPC semantics (value vs handle types)\n\nProposed Solution:\n- Add explicit types: i8, i16, i32, i64, u8, u16, u32, u64, f32, f64\n- Add string, bytes collection types\n- Add vector\u003cT\u003e, array\u003cT,N\u003e, map\u003cK,V\u003e, optional\u003cT\u003e\n- Add shared_handle\u003cT\u003e, optimistic_handle\u003cT\u003e for RPC semantics\n\nImplementation Phases:\nPhase 1: AST Enhancement (2-3 weeks)\nPhase 2: Code Generator Updates (3-4 weeks)\nPhase 3: Migration and Compatibility (2-3 weeks)\nPhase 4: Validation and Tooling (2 weeks)\n\nReference: docs/to_do/IDL_Type_System_Formalization.md\nLocations: submodules/idlparser/, generator/src/","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":2400,"created_at":"2026-01-12T14:28:02.080870716Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-12T14:28:02.080870716Z","labels":["foundational","idl","parser","type-system"]}
{"id":"canopy-2ae","title":"Audit and implement unimplemented tests","description":"Audit tests from Master Implementation Plan and implement missing test cases.\n\nStatus: NEEDS AUDIT\n\nConfirmed Missing Tests:\n- zone_terminating notification (depends on transport_down)\n- Zone termination broadcast tests\n- Cascading failure tests\n- post() timing tests\n- Transport status management unit tests\n\nTests Needing Verification:\n- Add/remove destinations unit test\n- service_proxy refuses DISCONNECTED traffic\n- All transport status monitoring tests\n- Auto-delete on zero counts\n- Enforce symmetry on failure\n- Y-topology explicit tests\n- And more...\n\nTasks:\n1. Run test coverage analysis\n2. Map existing tests to plan specifications\n3. Implement missing unit tests\n4. Verify integration tests cover all scenarios\n\nReference: docs/to_do/Unimplemented_Tests.md\nDependencies: transport_down implementation, zone termination","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":480,"created_at":"2026-01-12T14:28:02.446966155Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.526117319Z","labels":["quality","testing"],"dependencies":[{"issue_id":"canopy-2ae","depends_on_id":"canopy-bq5","type":"blocks","created_at":"2026-01-12T14:29:35.246847073Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-335","title":"Enhanced activity color-coding","description":"Improve color scheme for different activity types.\n\nFeatures:\n- Different colors for send vs post\n- Distinct colors for add_ref/release\n- Gradient or animation for phases (outbound → inbound → stub)\n- Color legend in UI\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nReference: visualiser.md section 8","status":"open","priority":4,"issue_type":"feature","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:46:57.767941015Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T11:59:34.499556523Z"}
{"id":"canopy-3gk","title":"Complete optimistic pointer IDL integration","description":"Add rpc::optimistic_ptr support to IDL parser and comprehensive testing.\n\nStatus: PARTIALLY IMPLEMENTED - runtime exists, IDL parser support missing\n\nCurrent Status:\n- rpc::optimistic_ptr\u003cT\u003e class exists in C++ runtime\n- Some tests exist in post_functionality_test_suite.cpp\n- NOT supported in IDL parser - can't declare in .idl files\n\nImplementation Tasks:\nWeek 1: IDL Parser Support\n- Study how rpc::shared_ptr is parsed\n- Add optimistic_ptr recognition to lexer/parser\n- Update code generator for marshalling\n\nWeek 2: Runtime Integration\n- Enhance optimistic_ptr class (is_valid(), mark_released())\n- Object stub optimistic holder tracking\n- Object proxy handling\n\nWeek 3: Testing\n- Unit tests for all scenarios\n- Integration tests with multiple zones\n- Pass-through routing tests\n\nReference: docs/to_do/Optimistic_Pointer_Support.md\nLocations: rpc/include/rpc/internal/remote_pointer.h (lines 1878-2066), submodules/idlparser/","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":720,"created_at":"2026-01-12T14:28:01.824370083Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.526613475Z","labels":["idl","optimistic-pointers","parser"],"dependencies":[{"issue_id":"canopy-3gk","depends_on_id":"canopy-m4a","type":"blocks","created_at":"2026-01-12T14:29:35.223409453Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-3hl","title":"Documentation cleanup: fix child_transport API examples and interface naming","description":"Comprehensive documentation update to fix outdated API usage and confusing interface naming.\n\nCompleted:\n- Moved 14 duplicate-numbered doc files to old_docs/\n- Updated get_current_service() documentation to clarify it's non-coroutine only\n- Fixed 5 files using outdated child_transport 4-parameter constructor API\n- Fixed connect_to_zone() calls to use 4 parameters (not 3)\n- Replaced confusing i_service examples with i_foo to avoid confusion with rpc::service class\n- Updated hierarchical examples to use i_example_parent/i_example_child pattern\n\nFiles updated:\n- documents/02-getting-started.md\n- documents/03-idl-guide.md\n- documents/10-examples.md\n- documents/11-best-practices.md\n- documents/architecture/01-overview.md\n- documents/architecture/02-zones.md\n- documents/architecture/03-services.md\n- documents/architecture/06-transports-and-passthroughs.md\n- documents/transports/local.md\n- documents/transports/tcp.md\n- documents/transports/hierarchical.md\n\nAll documentation now matches actual codebase patterns from tests/fuzz_test and demos/comprehensive.","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-25T19:03:37.404520479Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-25T19:03:44.176275068Z","closed_at":"2026-01-25T19:03:44.176275068Z","close_reason":"Documentation cleanup completed successfully. All child_transport examples now use correct 3-parameter constructor with set_child_entry_point(). All connect_to_zone() calls use 4 parameters. Confusing i_service interface examples replaced with i_foo and i_example_parent/i_example_child."}
{"id":"canopy-498","title":"Verify concurrent transport access in service","description":"Location: /rpc/src/service.cpp\n\nIssue: transports_ map protected by zone_control mutex with complex operations. Race between transport creation, access, and removal.\n\nTask: Audit all access patterns, consider std::shared_ptr in map values.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":360,"created_at":"2026-01-12T14:41:32.537931144Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.529693194Z"}
{"id":"canopy-55n","title":"Complete WebSocket and REST transport implementation","description":"Complete WebSocket and REST transport implementations for web-based RPC integration.\n\nStatus: IN PROGRESS - basic implementations working, needs production hardening and full RPC integration\n\nWebSocket Transport (4-6 weeks):\n- Basic server/client with wslay ✓\n- Message framing and RPC serialization ✓\n- Bi-modal support (sync/async) - NEEDED\n- Reconnection and heartbeat - NEEDED\n- Testing and JavaScript client example - NEEDED\n\nREST Transport (3-4 weeks):\n- HTTP request handling with llhttp ✓\n- JSON serialization ✓\n- Automatic route generation from IDL - NEEDED\n- OpenAPI generation - NEEDED\n- Authentication and CORS - NEEDED\n\nQUIC Transport: NOT STARTED (future work)\n\nReference: docs/to_do/WebSocket_REST_QUIC_Transport.md\nLocations: transports/websocket/, transports/rest/","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":960,"created_at":"2026-01-12T14:28:01.940174734Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.528479405Z","labels":["networking","rest","transport","websocket"]}
{"id":"canopy-5bb","title":"Implement rebuildVisualization() with tree layout and port registry","description":"# Task: Core Visualization Rendering Function\n\n## What\nReplace updateGraph() with rebuildVisualization() using tree layout\n\n## Where\nReplace function at lines ~2130-2378\n\n## High-Level Algorithm\n```javascript\nfunction rebuildVisualization() {\n    // 1. Build D3 hierarchy from zones{}\n    const rootZone = findRootZone();\n    const hierarchy = buildHierarchy(rootZone);\n    const root = d3.hierarchy(hierarchy);\n    \n    // 2. Calculate zone dimensions\n    zones.forEach(z =\u003e {\n        const colCount = Math.max(z.transports.length, z.passthroughs.length, 1);\n        z.width = Math.max(260, colCount * 90);\n        z.height = z.passthroughs.length \u003e 0 ? 260 : 140;\n    });\n    \n    // 3. Apply tree layout\n    const maxZWidth = d3.max(Object.values(zones), z =\u003e z.width);\n    d3.tree().nodeSize([maxZWidth + 150, 600])(root);\n    \n    // 4. Build PortRegistry with absolute coords\n    buildPortRegistry(root);\n    \n    // 5. Render trunk lines (parent-child connections)\n    renderTrunkLines(root);\n    \n    // 6. Render zones with internal circuitry\n    renderZones(root);\n}\n```\n\n## Sub-Functions Needed\n\n### buildHierarchy(zone)\nRecursively build tree structure:\n```javascript\nconst buildHierarchy = (z) =\u003e ({\n    id: z.id,\n    data: z,\n    children: z.children.map(cid =\u003e buildHierarchy(zones[cid]))\n});\n```\n\n### findRootZone()\nFind zone with parentId === 0:\n```javascript\nconst rootZone = Object.values(zones).find(z =\u003e z.parentId === 0) || Object.values(zones)[0];\n```\n\n### buildPortRegistry(root)\nMap port locations to absolute SVG coords - SEE NEXT TASK\n\n### renderTrunkLines(root)\nDraw thick lines between parent-child ports - SEE NEXT TASK\n\n### renderZones(root)\nDraw zone boxes, service boxes, transport ports, passthroughs - SEE NEXT TASK\n\n## Call Sites\nCall rebuildVisualization() when topology changes:\n- After createZone()\n- After createTransport()  \n- After deleteZone()\n- After deleteTransport()\n- On window resize\n\n## Dependencies\n- Requires zones{} populated\n- Requires PortRegistry implementation\n- Requires rendering functions\n\n## Test Strategy\n1. Start simple: Just render zone boxes\n2. Add trunk lines\n3. Add transport ports\n4. Add internal wiring\n5. Add passthroughs last","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:37:38.996691469Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T12:03:39.52131679Z","closed_at":"2026-01-21T12:03:39.52131679Z","close_reason":"Tree layout implementation complete. Visualization now uses hierarchical tree layout with port registry, trunk lines, and SVG viewBox coordinate system."}
{"id":"canopy-6fu","title":"Populate zones{} from service_creation events","description":"# Task: Build zones{} from Events\n\n## What\nUpdate ensureZoneNode() to populate zones{} structure\n\n## Where\ntelemetry/src/animation_telemetry_service.cpp lines ~417-535\n\n## Current Approach  \nensureZoneNode() only creates entry in nodes Map\n\n## New Approach\nAlso create zones{} entry:\n```javascript\nfunction ensureZoneNode(zoneNumber) {\n    const zoneId = normalizeZoneNumber(zoneNumber);\n    \n    // Existing nodes Map logic...\n    if (!nodes.has(zoneId)) {\n        nodes.set(zoneId, { /* ... */ });\n    }\n    \n    // NEW: Also populate zones{}\n    if (!zones[zoneId]) {\n        const zoneMeta = zoneMetadata[zoneId] || {};\n        zones[zoneId] = {\n            id: zoneId,\n            name: zoneMeta.name || `zone_${zoneId}`,\n            parentId: zoneMeta.parent || 0,\n            transports: [],\n            passthroughs: [],\n            children: []\n        };\n        \n        // Initialize adjacency list\n        if (!adjacencyList[zoneId]) {\n            adjacencyList[zoneId] = new Set();\n        }\n    }\n    \n    return zoneId;\n}\n```\n\n## Also Update\n- createZone() event handler - ensure it calls ensureZoneNode()\n- Add parent-child relationship tracking\n\n## Test\nAfter change:\n1. Load visualization HTML\n2. Check console: `console.log(zones)` should show hierarchy\n3. Verify zones have correct parent relationships","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:36:48.316713758Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T23:04:28.070485594Z","closed_at":"2026-01-20T23:04:28.070485594Z","close_reason":"Closed"}
{"id":"canopy-6gj","title":"Verify TCP transport send queue lock scope","description":"Location: /transports/tcp/transport.cpp:463\n\nIssue: Lock might be released during coroutine suspension points within processing loop.\n\nTask: Verify lock is held across entire queue processing. Document suspension point behavior.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:31.847337997Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.527014421Z"}
{"id":"canopy-764","title":"Enhance static analysis with clang-tidy","description":"Enhance static analysis coverage with comprehensive clang-tidy configuration.\n\nStatus: PLANNED\n\nCurrent State:\n- Minimal .clang-tidy configuration\n- Limited static analysis coverage\n- No automated quality gates\n\nProposed Configuration:\n1. Enable bugprone-* checks for common programming errors\n2. Enable performance-* checks for optimization opportunities\n3. Enable modernize-* checks (selective) for C++20 idioms\n4. Enable cppcoreguidelines-* checks for best practices\n5. Configure appropriate severity levels and exclusions\n\nIntegration:\n- Add clang-tidy to CI pipeline\n- Set up pre-commit hooks (optional)\n- Create baseline for existing issues\n- Establish zero-new-issues policy\n\nBenefits:\n- Catch bugs earlier in development\n- Enforce coding standards\n- Improve code quality automatically\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md (Section 4.1)","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":320,"created_at":"2026-01-12T14:28:36.462041872Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.530011935Z","labels":["ci","quality","tooling"]}
{"id":"canopy-7i3","title":"Verify object proxy reference counting","description":"Location: /rpc/src/object_proxy.cpp\n\nIssue: shared_count_ and optimistic_count_ atomics in complex remote reference logic. Complex state machine involving local/remote operations may have races.\n\nTask: Review add_ref() and release() for proper sequencing. Verify state machine correctness.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":360,"created_at":"2026-01-12T14:41:32.191946533Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.527641815Z"}
{"id":"canopy-7t9","title":"Verify thread-local logger circular buffer","description":"Location: /rpc/src/thread_local_logger.cpp\n\nIssue: write_index_ atomic in circular buffer. Multiple threads could overwrite entries if not properly synchronized.\n\nTask: Verify buffer is thread-local OR has proper CAS operations.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:32.429871872Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.527308576Z"}
{"id":"canopy-7zk","title":"Replace force-directed graph with hierarchical tree visualization","description":"# Visualization Refactor - COMPLETED\n\n## Summary\nSuccessfully replaced D3 force-directed graph with hierarchical tree layout using port-to-port wiring from test.html.\n\n## Changes Made\n\n### 1. Data Structures (✓)\n- Added  object for tree hierarchy\n- Added  for BFS pathfinding\n- Added  for port-to-port connections\n\n### 2. Event Processing (✓)\n- Updated  to populate zones{}\n- Updated  to track transports[] and adjacencyList\n- Updated  to track passthroughs[]\n- Added  BFS pathfinding function\n\n### 3. Visualization Rendering (✓)\n- Removed D3 force simulation completely\n- Implemented  with:\n  - d3.tree() hierarchical layout\n  - PortRegistry with absolute coordinates\n  - Trunk lines connecting parent-child zones\n  - Zone rendering with internal circuitry\n  - Transport ports on zone edges (distributed evenly)\n  - Service box in center with wires to ports\n  - Passthrough routing with BFS pathfinding\n- Updated  to redirect to rebuildVisualization()\n\n### 4. CSS Styles (✓)\n- Replaced force-graph styles with new port-wiring styles\n- Trunk lines, zone backgrounds, service/transport boxes\n- Wires (normal and routing), passthrough circles\n- Error rings for failed routing\n\n## Test Results\n```bash\ncd /home/edward/projects/Canopy/build_debug\n./output/rpc_test --telemetry-animation --gtest_filter=remote_type_test/0.check_unknown_zone_reference_path\n# PASSED\n```\n\nGenerated HTML: `rpc_test_diagram/remote_type_test#0/check_unknown_zone_reference_path.html`\n\n## Files Modified\n- telemetry/src/animation_telemetry_service.cpp\n  - CSS (lines 252-314): New visualization styles\n  - JavaScript (lines 382-2337): Core refactor\n\n## Build Status\n✓ Compiles successfully\n✓ Test passes\n✓ HTML generated\n\n## What Works\n- Hierarchical tree layout\n- Zones render as boxes with correct dimensions\n- Transport ports on edges\n- Trunk lines between parent-child\n- Internal wiring from service to ports\n- Passthrough routing (with BFS)\n\n## Known Limitations\n- No activity pulse animations yet (old nodes Map still exists but not visualized)\n- No hover tooltips on new tree nodes\n- Zoom/pan works but no drag behavior on tree nodes\n- Timeline controls work (play/pause/seek)","status":"closed","priority":2,"issue_type":"epic","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:36:15.090916648Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T12:03:39.559101047Z","closed_at":"2026-01-21T12:03:39.559101047Z","close_reason":"Tree layout implementation complete. Visualization now uses hierarchical tree layout with port registry, trunk lines, and SVG viewBox coordinate system."}
{"id":"canopy-8eb","title":"Verify service proxy management in service","description":"Location: /rpc/src/service.cpp\n\nIssue: other_zones_ map protected by zone_control mutex. Similar to transport management - race between creation, access, removal.\n\nTask: Ensure consistent locking and reference counting.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":360,"created_at":"2026-01-12T14:41:32.64801954Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.527922234Z"}
{"id":"canopy-8lg","title":"Populate transports and adjacencyList from transport_creation","description":"# Task: Track Transports in zones{}\n\n## What\nUpdate createTransport() to populate zones[].transports[] and adjacencyList\n\n## Where\ntelemetry/src/animation_telemetry_service.cpp lines ~1595-1665\n\n## Current Code\ncreateTransport() creates transport nodes in nodes Map and links\n\n## New Code\nAlso update zones{} structure:\n```javascript\nfunction createTransport(evt) {\n    const zone1Number = normalizeZoneNumber(evt.data.zone_id);\n    const zone2Number = normalizeZoneNumber(evt.data.adjacent_zone_id);\n    \n    // Existing code creates transport nodes...\n    \n    // NEW: Update zones{} structure\n    if (zones[zone1Number]) {\n        zones[zone1Number].transports.push({ \n            adjId: zone2Number \n        });\n        \n        // Update adjacency list\n        if (!adjacencyList[zone1Number]) adjacencyList[zone1Number] = new Set();\n        if (!adjacencyList[zone2Number]) adjacencyList[zone2Number] = new Set();\n        adjacencyList[zone1Number].add(zone2Number);\n        adjacencyList[zone2Number].add(zone1Number);\n        \n        // Track parent-child relationship (only once)\n        if (zone2Number \u003e zone1Number) {\n            zones[zone1Number].children.push(zone2Number);\n        }\n    }\n}\n```\n\n## Also Handle\n- transport_deletion - remove from transports[] and adjacencyList\n\n## Test\nAfter change:\n1. Create transport between zones 1 and 2\n2. Check `zones[1].transports` contains {adjId: 2}\n3. Check `adjacencyList[1]` contains 2\n4. Check `zones[1].children` contains 2 (if 2 \u003e 1)","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:37:09.703182481Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T23:04:28.072767815Z","closed_at":"2026-01-20T23:04:28.072767815Z","close_reason":"Closed"}
{"id":"canopy-90a","title":"Fix TCP transport shutdown_event_ access","description":"Location: /transports/tcp/transport.cpp\n\nIssue: shutdown_event_ set from multiple places without clear synchronization.\n\nFix: Ensure atomic or mutex-protected access. Consider single shutdown coordination point.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"bug","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:31.963251524Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.529357821Z"}
{"id":"canopy-9ex","title":"Verify service proxy version negotiation","description":"Location: /rpc/src/service_proxy.cpp\n\nIssue: version_ atomic modified during version negotiation. Potential race during concurrent version negotiation attempts.\n\nTask: Ensure idempotent negotiation and use compare-and-swap where needed.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:32.326977597Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.528188696Z"}
{"id":"canopy-9i2","title":"Test service proxy telemetry visualization","description":"After adding telemetry events for service proxies, object proxies, and stubs, need to rebuild and test to verify all boxes appear in telemetry animation.\n\nChanges complete:\n- Service proxy creation telemetry event added to service_proxy.cpp\n- Object proxy and stub already have telemetry events\n- All visualization code complete (service proxies, object proxies, stubs)\n\nSteps to test:\n1. Rebuild rpc_test target\n2. Run: ./rpc_test --telemetry-animation --telemetry-console --gtest_filter=remote_type_test/0.check_identity\n3. Verify all boxes appear in generated HTML reports:\n   - Service proxies (purple) - destination zone and ref counts\n   - Object proxies (pink/rose) - object ID and destination zone\n   - Stubs (green) - object ID and memory address\n4. Check that boxes are positioned correctly below each other\n5. Verify wire connections to service box","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-28T15:25:47.055358484Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-28T18:24:38.351136835Z"}
{"id":"canopy-a1l","title":"Performance testing and optimization for large event datasets","description":"Test and optimize visualization with large datasets.\n\nTasks:\n- Benchmark with 1K, 5K, 10K event datasets\n- Profile rendering bottlenecks\n- Implement throttling for playback updates\n- Consider virtualization for large node counts\n- Optimize D3 data joins\n\nTarget: Smooth playback with 10,000 events\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nReference: visualiser.md section 10","status":"open","priority":4,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:47:05.194688652Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T11:59:34.521396808Z"}
{"id":"canopy-ac2","title":"Relay activity pulses missing when destination transports not yet present","description":"When relay add_ref events (options=3) arrive before destination transport nodes exist, activity pulses do not render. Add a deferred rendering or fallback path so relay pulses are visible even if destination transport nodes are created later.","acceptance_criteria":"Relay add_ref pulses render consistently even if destination transports are created after the event (verified in check_unknown_zone_reference_path.html).","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-22T13:37:40.424626012Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-22T13:49:51.38014906Z","closed_at":"2026-01-22T13:49:51.38014906Z","close_reason":"Closed"}
{"id":"canopy-aly","title":"Fix layout corruption when moving timeline scrollbar","description":"CRITICAL: Moving the timeline scrollbar causes the visualization layout to become corrupted.\n\nSymptoms:\n- Zones reposition incorrectly when scrubbing timeline\n- Layout does not restore to original state\n- May be related to rebuildVisualization() being called during timeline updates\n\nInvestigation needed:\n- Check if rebuildVisualization() is being called on every timeline update\n- Verify viewBox calculations remain consistent\n- Ensure zone positions are stable across timeline changes\n\nExpected: Layout should remain stable when moving through timeline\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nFunctions: rebuildVisualization(), processEventsUntil()\n\nPriority: P0 - Blocks all other visualization work","status":"closed","priority":0,"issue_type":"bug","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:59:19.797924321Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T17:40:02.402218627Z","closed_at":"2026-01-21T17:40:02.402218627Z","close_reason":"Fixed by adding transport reference count tracking which resolved layout corruption during timeline scrubbing"}
{"id":"canopy-azs","title":"Implementation notes for rebuildVisualization()","description":"# rebuildVisualization() Implementation Progress\n\n## Completed\n- Removed D3 force simulation\n- Updated all call sites (typeFilters, showLog, resize, initial)  \n- Added zones{}, adjacencyList, PortRegistry data structures\n- Populated zones{} from ensureZoneNode(), createTransport(), createPassthrough()\n- Added findNextHop() BFS pathfinding\n\n## Current Status\nAbout to implement rebuildVisualization() function to replace updateGraph()\n\n## Location  \nReplace updateGraph() at line ~2130\n\n## Key Implementation Steps\n\n### 1. Build Tree Hierarchy\n```javascript\nfunction rebuildVisualization() {\n    // Clear SVG\n    g.selectAll('*').remove();\n    \n    // Find root zone (parentId === 0)\n    const rootZoneData = Object.values(zones).find(z =\u003e z.parentId === 0) || Object.values(zones)[0];\n    if (\\!rootZoneData) return;\n    \n    // Build hierarchy\n    const buildHierarchy = (z) =\u003e ({\n        id: z.id,\n        data: z,\n        children: z.children.map(cid =\u003e buildHierarchy(zones[cid]))\n    });\n    const root = d3.hierarchy(buildHierarchy(rootZoneData));\n    \n    // Calculate zone dimensions\n    Object.values(zones).forEach(z =\u003e {\n        const colCount = Math.max(z.transports.length, z.passthroughs.length, 1);\n        z.width = Math.max(260, colCount * 90);\n        z.height = z.passthroughs.length \u003e 0 ? 260 : 140;\n    });\n    \n    // Apply tree layout\n    const maxZWidth = d3.max(Object.values(zones), z =\u003e z.width) || 260;\n    d3.tree().nodeSize([maxZWidth + 150, 600])(root);\n    \n    // Build port registry, render trunk lines, render zones\n    buildPortRegistry(root);\n    renderTrunkLines(root);\n    renderZones(root);\n}\n```\n\n### 2. Port Registry\nMaps 'zoneId:adjId' -\u003e {relX, relY, absX, absY}\n\n### 3. Render Trunk Lines  \nThick lines connecting parent OUT port to child IN port\n\n### 4. Render Zones\nEach zone gets:\n- Zone background box\n- Service box (center)\n- Transport ports (bottom edge, distributed)\n- Wires from service to ports\n- Passthroughs (if any) with routing wires\n\n## Test After Implementation\n```bash\ncd /home/edward/projects/Canopy/build_debug  \n./output/rpc_test --telemetry-animation --gtest_filter=remote_type_test/0.check_unknown_zone_reference_path\n# Open generated HTML\n```","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T23:05:53.573775091Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T23:14:44.100359739Z","closed_at":"2026-01-20T23:14:44.100359739Z","close_reason":"rebuildVisualization() implemented successfully. Test generates HTML at rpc_test_diagram/remote_type_test#0/check_unknown_zone_reference_path.html"}
{"id":"canopy-b6q","title":"Extract animation telemetry UI templates","description":"Move the animation telemetry HTML layout, CSS, and JavaScript out of the generated report into reusable template files under telemetry/html_templates/animation. Update the telemetry output to load the UI from the template (via iframe + postMessage) while keeping telemetryMeta, events, and totalDuration in the report HTML.","acceptance_criteria":"Telemetry reports load layout/CSS/JS from templates; generated HTML only contains data + loader; UI still functions in Firefox.","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-22T11:07:20.169756099Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-22T11:08:15.745603476Z","closed_at":"2026-01-22T11:08:15.74560551Z"}
{"id":"canopy-bq5","title":"Implement transport failure detection and zone shutdown","description":"Implement transport_down() for failure notification and graceful shutdown via reference counting.\n\nStatus: DESIGNED BUT NOT PROPERLY HANDLED\n\nTwo scenarios to handle:\n1. Ungraceful Failure: transport_down() notification when transport fails\n2. Graceful Shutdown: Natural zone termination through reference counting (no notifications)\n\nKey Tasks:\n- Implement heartbeat mechanism for failure detection\n- Add transport_down() cascading cleanup\n- Implement reference count based cleanup\n- Handle parent-stays-alive logic for hierarchical transports\n- Proxy invalidation on failure\n- Pass-through cascade support\n\nReference: docs/to_do/Transport_Failure_And_Zone_Shutdown.md\nLocations: rpc/include/rpc/internal/marshaller.h (lines 177-181), rpc/include/rpc/internal/transport.h","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":1200,"created_at":"2026-01-12T14:28:01.590357329Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.522175975Z","labels":["core-rpc","reliability","transport"]}
{"id":"canopy-bv1","title":"Perform memory ordering audit for all atomics","description":"Phase 3 of thread safety work.\n\nTasks:\n1. Verify all atomic operations have appropriate memory ordering\n2. Document memory ordering choices with rationale\n3. Add static assertions or comments explaining ordering decisions\n4. Review relaxed ordering optimization opportunities (sequence numbers, IDs)\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.5 Phase 3\n\nDocumentation required for each atomic:\n- Why this memory ordering was chosen\n- What synchronizes-with relationships exist\n- References to C++ memory model guarantees","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":960,"created_at":"2026-01-12T14:41:45.386802939Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.518841687Z","dependencies":[{"issue_id":"canopy-bv1","depends_on_id":"canopy-o05","type":"blocks","created_at":"2026-01-12T14:41:58.515209178Z","created_by":"Edward Boggis-Rolfe"},{"issue_id":"canopy-bv1","depends_on_id":"canopy-g4h","type":"blocks","created_at":"2026-01-12T14:41:58.537845047Z","created_by":"Edward Boggis-Rolfe"},{"issue_id":"canopy-bv1","depends_on_id":"canopy-v5y","type":"blocks","created_at":"2026-01-12T14:41:58.559158913Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-d1v","title":"Audit and eliminate ambiguous raw pointer usage","description":"Audit and eliminate raw pointer usage to clarify ownership semantics.\n\nStatus: PLANNED\n\nCurrent Issues:\n- service::clean_up_on_failed_connection takes rpc::casting_interface* input_interface\n- service::get_object_id takes rpc::shared_ptr\u003ccasting_interface\u003e\u0026 ptr\n- Various other raw pointer usages throughout codebase\n\nGuidelines:\n- Use references (\u0026) for non-null observers\n- Use std::optional\u003cT*\u003e or nullable pointers for optional parameters\n- Ensure ownership is never transferred via raw pointers\n- Document ownership semantics in function contracts\n\nBenefits:\n- Clearer ownership semantics\n- Reduced risk of dangling pointers\n- Better static analysis results\n- More maintainable code\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md (Section 2.3)","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":480,"created_at":"2026-01-12T14:28:36.640736301Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.514259253Z","labels":["refactoring","safety"]}
{"id":"canopy-dzn","title":"Code generator modernization and refactoring","description":"Refactor monolithic code generator into maintainable, testable components.\n\nStatus: PLANNED - HIGH PRIORITY\n\nCurrent State:\n- generator/src/protobuf_generator.cpp is ~3000 lines\n- 'Stringly typed' C++ code generation approach\n- Monolithic structure makes maintenance difficult\n- Hard to add new features or modify existing output\n\nProposed Refactoring:\nPhase 1: Component Extraction (2 weeks)\n- Create TypeMapper class for type conversions\n- Create MessageGenerator class for message/struct generation\n- Create ServiceGenerator class for interface generation\n- Create CodeFormatter utility\n\nPhase 2: Template System Evaluation (1 week)\n- Evaluate template engines (Mustache, Jinja2-style, custom)\n- Proof-of-concept with selected engine\n\nPhase 3: Implementation (2-3 weeks)\n- Implement chosen approach\n- Migrate existing generation logic\n- Add comprehensive unit tests\n\nBenefits:\n- Easier to maintain and extend\n- Better separation of concerns\n- More testable code\n- Reduced risk of code generation bugs\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md (Section 3.2)\nLocations: generator/src/protobuf_generator.cpp, generator/src/synchronous_generator.cpp","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":1920,"created_at":"2026-01-12T14:28:02.680754265Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.520820018Z","labels":["architecture","code-generation","maintenance"]}
{"id":"canopy-f7o","title":"Implement DLL/Shared Object transport","description":"Implement bi-modal hierarchical transport for loading zones from shared libraries (DLLs/.so files).\n\nStatus: PLANNED - NOT YET STARTED\n\nRequirements:\n- Bi-modal support (synchronous and asynchronous modes)\n- Hierarchical architecture (parent-child, not peer-to-peer)\n- Direct function calls in sync mode, message queue in async mode\n- Scheduler options: shared or dedicated for DLL zone\n\nUse Cases:\n- Plugin architectures with hot-reloadable DLLs\n- Sandboxed extension zones in same process\n- Modular applications with dynamically loaded components\n\nImplementation Tasks (4-6 weeks):\nWeek 1-2: Design DLL transport interface and loading mechanism\nWeek 2-3: Implement synchronous mode\nWeek 3-4: Implement asynchronous mode\nWeek 5: Integration and testing\nWeek 6: Documentation and examples\n\nReference: docs/to_do/DLL_Shared_Object_Transport.md","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":1200,"created_at":"2026-01-12T14:28:02.198679756Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.521306375Z","labels":["dll","plugins","transport"]}
{"id":"canopy-ffw","title":"Complete post() testing and documentation","description":"Complete testing and documentation for post() fire-and-forget messaging.\n\nStatus: PARTIALLY IMPLEMENTED - implementation exists but needs comprehensive testing and non-coroutine considerations\n\nCurrent Issues:\n- Documentation may be incorrect - needs review\n- Non-coroutine behavior not fully tested\n- Comprehensive unit testing incomplete\n\nTasks:\n1. Fix documentation in marshaller.h\n2. Add non-coroutine tests\n3. Verify bi-modal behavior (sync and async modes)\n4. Add timing tests for async mode\n5. Document blocking behavior in sync mode\n6. Verify no-response handling\n\nReference: docs/to_do/Post_Function_Implementation_And_Testing.md\nLocation: rpc/include/rpc/internal/marshaller.h","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":480,"created_at":"2026-01-12T14:28:01.475166415Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.52256566Z","labels":["core-rpc","documentation","testing"],"dependencies":[{"issue_id":"canopy-ffw","depends_on_id":"canopy-lgy","type":"blocks","created_at":"2026-01-12T18:16:31.865397865Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-g4h","title":"Fix pending transmits shutdown race","description":"Location: Both tcp_transport and spsc_transport\n\nIssue: pending_transmits_ map cleared during shutdown while requests might be completing. Race between pending request completion and map clearing.\n\nFix approach:\n1. Set shutdown flag atomically\n2. Drain pending requests with timeout\n3. Only then clear map\n4. Handle late completions gracefully\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.2","status":"open","priority":1,"issue_type":"bug","owner":"edward@boggis-rolfe.com","estimated_minutes":480,"created_at":"2026-01-12T14:41:31.514911554Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.519641425Z"}
{"id":"canopy-gj2","title":"Fix parent/child transport circular dependency crash on unwinding","description":"## Problem\n\nCircular dependency between child_service and parent/child transports can cause crash when child_service releases parent_transport while it's still on the call stack.\n\n### Current Architecture\n\n1. **child_service** (child zone) holds `std::shared_ptr\u003cparent_transport\u003e` (service.h:432)\n2. **parent_transport** (child zone) holds `stdex::member_ptr\u003cchild_transport\u003e` pointing to parent zone (local/transport.h:20)\n3. **child_transport** (parent zone) holds `stdex::member_ptr\u003cparent_transport\u003e` pointing back to child (local/transport.h:110)\n\nThis circular dependency is **by design** - it keeps zones alive as long as references exist in either direction.\n\n### Crash Scenario\n\nWhen child_service releases the last shared_ptr to parent_transport:\n1. If parent_transport is on call stack (calls from parent zone go through child_transport which calls child-\u003einbound_*)\n2. Transport gets destroyed while still active\n3. Stack unwinds through destroyed object → crash\n\n### Root Cause\n\nThe parent_transport needs to stay alive through the call stack, then be properly disconnected after the call completes.\n\n## Proposed Solution\n\n### Key Insight\n\nThe `child_transport::outbound_*()` methods already have built-in protection:\n\n```cpp\nCORO_TASK(int) child_transport::outbound_send(...) {\n    auto child = child_.get_nullable();  // Stack-based shared_ptr\u003cparent_transport\u003e\n    if (!child) {\n        CO_RETURN rpc::error::ZONE_NOT_FOUND();\n    }\n    \n    // child shared_ptr is on the stack - keeps parent_transport alive\n    CO_RETURN CO_AWAIT child-\u003einbound_send(...);\n    // When stack unwinds, child shared_ptr destructs naturally\n}\n```\n\nThis stack-based `shared_ptr` **already keeps parent_transport alive** during the call, even if child_service releases its reference!\n\n### Requirements\n\n1. **Zone Boundary Respect**: child_service only interacts with its own parent_transport (in child zone)\n2. **Status Propagation**: parent_transport propagates DISCONNECTED status to parent zone's child_transport\n3. **Circular Reference Break**: child_transport breaks its child_ reference when notified\n4. **Stack-based Protection**: The existing `auto child = child_.get_nullable()` provides automatic lifetime management\n\n### Implementation Approach\n\n#### 1. Override set_status in parent_transport\n\n```cpp\nclass parent_transport : public rpc::transport {\n    stdex::member_ptr\u003cchild_transport\u003e parent_;\n\npublic:\n    void set_status(transport_status status);\n};\n```\n\n#### 2. Propagate Disconnect to Parent Zone\n\n```cpp\nvoid parent_transport::set_status(transport_status status) {\n    // Call base class to update status\n    transport::set_status(status);\n    \n    // If disconnecting, notify parent zone to break circular reference\n    if (status == transport_status::DISCONNECTED) {\n        auto parent = parent_.get_nullable();\n        if (parent) {\n            // Notify parent zone's child_transport to break its child_ reference\n            parent-\u003eon_child_disconnected();\n        }\n        // Break our reference to parent\n        parent_.reset();\n    }\n}\n```\n\n#### 3. Add Disconnect Notification to child_transport\n\n```cpp\nclass child_transport : public rpc::transport {\n    stdex::member_ptr\u003cparent_transport\u003e child_;\n\npublic:\n    void on_child_disconnected();\n};\n```\n\n```cpp\nvoid child_transport::on_child_disconnected() {\n    // Break circular reference - safe because stack-based shared_ptr keeps child alive\n    child_.reset();\n}\n```\n\n#### 4. Trigger from child_service Destructor\n\n```cpp\nchild_service::~child_service() {\n    auto parent = get_parent_transport();\n    if (parent) {\n        // Set status on our own transport (child zone)\n        // This will propagate to parent zone via override\n        parent-\u003eset_status(transport_status::DISCONNECTED);\n    }\n}\n```\n\n### Call Flow Protection\n\n```\nchild_service destructor runs (child zone)\n  └─\u003e parent_transport-\u003eset_status(DISCONNECTED)  // In child zone\n       └─\u003e parent_transport::set_status() override\n            ├─\u003e transport::set_status(DISCONNECTED)\n            ├─\u003e parent-\u003eon_child_disconnected()     // Notify parent zone\n            │    └─\u003e child_transport::child_.reset()\n            └─\u003e parent_.reset()                     // Break our reference\n\nMeanwhile, on call stack in parent zone:\n  child_transport::outbound_send()\n    ├─\u003e auto child = child_.get_nullable()  // Gets parent_transport, ref count++\n    │   (child_service may destruct here, but parent_transport stays alive!)\n    ├─\u003e child-\u003einbound_send() executes\n    └─\u003e stack unwinds\n         └─\u003e child shared_ptr destructs     // ref count--\n              └─\u003e if ref count == 0, parent_transport destructs\n```\n\n### Why This Works\n\n1. **Zone boundaries respected**: child_service only calls method on its own transport\n2. **Stack-based shared_ptr**: `auto child = child_.get_nullable()` creates a shared_ptr on the stack\n3. **Reference counting**: This increments parent_transport's ref count\n4. **Protected lifetime**: Even if child_service releases its reference, stack-based shared_ptr keeps parent_transport alive\n5. **Status propagation**: Disconnect notification crosses zone boundary properly\n6. **Natural cleanup**: When stack unwinds, shared_ptr destructs, ref count drops to 0, parent_transport destructs safely\n\n### Ownership Model\n\nAs designed:\n- **Passthroughs, proxies, stubs, child_service** hold `shared_ptr\u003cparent_transport\u003e`\n- **Stack-based protection**: `child_transport::outbound_*()` methods hold temporary `shared_ptr\u003cparent_transport\u003e` on stack\n- Once all references released AND stack unwound, parent_transport destructs naturally\n- Circular references broken by status propagation mechanism\n\n## Files to Modify\n\n- `transports/local/include/transports/local/transport.h` \n  - Override `set_status()` in parent_transport\n  - Add `on_child_disconnected()` to child_transport\n- `transports/local/src/transport.cpp` \n  - Implement parent_transport::set_status() override with propagation logic\n  - Implement child_transport::on_child_disconnected()\n- `rpc/src/service.cpp`\n  - Call parent_transport-\u003eset_status(DISCONNECTED) from child_service destructor\n\n## Testing\n\n- Verify parent_transport survives call stack unwinding\n- Verify parent_transport destructs after stack unwinds\n- Verify status propagates correctly across zones\n- Test with fuzz_test multi-level hierarchies\n- Test with telemetry to observe ref counts and transport lifetimes\n- ThreadSanitizer verification for race conditions\n- Stress test with rapid zone creation/destruction\n\n## Related Issues\n\nThis is foundational to the lifetime management architecture and relates to:\n- canopy-v5y - Service proxy map races\n- canopy-g4h - Pending transmits shutdown race\n- canopy-zw9 - Deadlock risk mitigation","status":"open","priority":1,"issue_type":"bug","owner":"edward@boggis-rolfe.com","created_at":"2026-01-23T16:57:20.938968704Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-23T17:16:12.598651153Z"}
{"id":"canopy-hku","title":"Re-enable hover tooltips for nodes","description":"Restore hover tooltip functionality (currently commented out at lines 804-819).\n\nShow details on hover:\n- Zone: name, parent, child count, transport count\n- Transport: status, adjacent zones  \n- Proxy: type, destination zone, object ID\n- Impl/Stub: address, object ID\n- Passthrough: forward/reverse destinations\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nReference: visualiser.md section 2","status":"open","priority":3,"issue_type":"feature","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:46:32.49034417Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T11:59:34.43339936Z"}
{"id":"canopy-irr","title":"Fix stub reference counting for out param passthrough pipeline","description":"Fixed a critical reference counting issue in object_stub::add_ref where stubs were not creating a passthrough pipeline to the caller when an out param is created.\n\nKey changes:\n- Added 'outcall' parameter to object_stub::add_ref() signature\n- When outcall=true, stub now calls transport-\u003eadd_ref() with build_caller_route flag\n- This ensures the caller can make calls back to the object through the passthrough\n\nFiles modified:\n- rpc/include/rpc/internal/stub.h: Updated add_ref signature\n- rpc/src/stub.cpp: Implemented outcall logic in add_ref\n- rpc/src/service.cpp: Updated call sites\n- rpc/src/transport.cpp: Updated call sites\n- tests/test_host/remote_type_test_suite.cpp: Updated tests\n\nThis fix ensures proper bidirectional communication when objects are passed as out parameters across zone boundaries.","status":"closed","priority":1,"issue_type":"bug","owner":"edward@boggis-rolfe.com","created_at":"2026-01-27T19:27:56.461021123Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-27T19:28:10.222836536Z","closed_at":"2026-01-27T19:28:10.222836536Z","close_reason":"Fix completed and tested. Stub now correctly creates passthrough pipeline to caller when out params are created."}
{"id":"canopy-j4n","title":"Add BFS pathfinding for passthrough routing","description":"# Task: Implement findNextHop() for Passthroughs\n\n## What\nAdd BFS pathfinding function to determine routing through zones\n\n## Where\nAdd after data structure declarations, around line ~415\n\n## Code\n```javascript\n// Find next hop on path from startNode to targetNode\nfunction findNextHop(startNode, targetNode) {\n    if (startNode === targetNode) return startNode;\n    \n    let queue = [[startNode]];\n    let visited = new Set([startNode]);\n    \n    while (queue.length \u003e 0) {\n        let path = queue.shift();\n        let node = path[path.length - 1];\n        \n        if (node === targetNode) {\n            // Return second node in path (next hop)\n            return path[1];\n        }\n        \n        const neighbors = adjacencyList[node];\n        if (neighbors) {\n            for (let neighbor of neighbors) {\n                if (!visited.has(neighbor)) {\n                    visited.add(neighbor);\n                    queue.push([...path, neighbor]);\n                }\n            }\n        }\n    }\n    \n    return null;  // No path found\n}\n```\n\n## Why Needed\nPassthroughs route traffic through intermediate zones. Need to determine which transport port to use based on shortest path to destination.\n\n## Usage\nWill be used in passthrough rendering to draw routing wires:\n```javascript\nconst nextHopRev = findNextHop(z.id, p.reverse_destination);\nconst nextHopFwd = findNextHop(z.id, p.forward_destination);\n```\n\n## Test\nAfter adding:\n1. Create zones 1, 2, 3 with transports 1-2, 2-3\n2. Call `findNextHop(1, 3)` should return 2\n3. Verify path exists before rendering wires","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:37:10.317895412Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T23:04:28.074806016Z","closed_at":"2026-01-20T23:04:28.074806016Z","close_reason":"Closed"}
{"id":"canopy-jm1","title":"Implement activity pulse animation for message flow","description":"Animate dots/pulses showing message flow through the system.\n\nFor each *_send/*_post event:\n- Create animated dot at source node\n- Animate along path to destination\n- Duration proportional to playback speed\n- Color-code by activity type\n- Support multi-hop routing through passthroughs\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nReference: visualiser.md section 1","status":"open","priority":2,"issue_type":"feature","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:46:25.634664439Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T11:59:27.693252535Z"}
{"id":"canopy-kfw","title":"Refactor pass_through to use template parameter for testability","description":"Refactor pass_through class to take a template parameter replacing the std::shared_ptr\u003cservice\u003e type for service_. This enables testing with mock services to validate all i_marshaller method activities without requiring full service infrastructure.","status":"closed","priority":1,"issue_type":"task","assignee":"Edward Boggis-Rolfe","owner":"edward@boggis-rolfe.com","created_at":"2026-01-12T18:16:20.50667097Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.517941439Z","closed_at":"2026-01-17T20:24:37.861022348Z","close_reason":"Closed"}
{"id":"canopy-lgy","title":"Create comprehensive pass_through test suite with test transport","description":"Progress: Created comprehensive test infrastructure with bimodal (blocking/coroutine) support following the inproc_setup pattern. Completed: 1) Mock test transport (transports/mock_test/) with call tracking and failure simulation, 2) passthrough_setup.h class with CoroSetUp/CoroTearDown/set_up/tear_down methods, 3) passthrough_test_v2.cpp with 13 bimodal tests covering happy and unhappy paths, 4) CMake integration with proper dependencies. Status: Tests compile successfully but encounter segfault during execution. Next: Debug runtime issue (likely scheduler/threading related), add remaining multithreaded/stress tests once basic tests are stable.","status":"closed","priority":1,"issue_type":"task","assignee":"Edward Boggis-Rolfe","owner":"edward@boggis-rolfe.com","created_at":"2026-01-12T18:16:28.005321498Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.528865703Z","closed_at":"2026-01-17T20:24:40.838625643Z","close_reason":"Closed","dependencies":[{"issue_id":"canopy-lgy","depends_on_id":"canopy-kfw","type":"blocks","created_at":"2026-01-12T18:16:31.844506044Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-m4a","title":"Verify and test object_released() implementation","description":"Verify and comprehensively test object_released() unidirectional notification system.\n\nStatus: IMPLEMENTED AND FUNCTIONAL - needs comprehensive testing and documentation\n\nImplementation Complete:\n- Zone tracking in object_stub (per-zone atomic counters)\n- Notification sending in service::release()\n- Transport routing (local, TCP, SPSC, pass-through)\n- Service event callback pattern\n\nNeeds Work:\n- Verify service_event handler usage in codebase\n- Comprehensive tests for notification flow\n- Multi-zone scenario tests\n- Pass-through routing tests\n- Documentation updates\n\nReference: docs/to_do/object_released_Method.md\nLocations: rpc/include/rpc/internal/marshaller.h (lines 168-174), rpc/src/service.cpp (lines 750-845)","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:28:01.712052084Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.517487723Z","labels":["core-rpc","optimistic-pointers","testing"],"dependencies":[{"issue_id":"canopy-m4a","depends_on_id":"canopy-ffw","type":"blocks","created_at":"2026-01-12T14:29:35.200672664Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-m9w","title":"Fix pragma compilation errors in generator/src/main.cpp","description":"Fixed compilation errors in generator/src/main.cpp caused by incorrectly formatted pragma directives around args.hxx include. Changed from chained _Pragma directives to proper #pragma syntax, corrected warning name from -Wno-gnu-zero-variadic-macro-arguments to -Wgnu-zero-variadic-macro-arguments, and added GCC compiler support alongside Clang.","acceptance_criteria":"Generator builds successfully without pragma-related errors","status":"closed","priority":2,"issue_type":"bug","owner":"edward@boggis-rolfe.com","created_at":"2026-01-22T20:58:15.947304878Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-22T20:58:19.748318724Z","closed_at":"2026-01-22T20:58:19.748318724Z","close_reason":"Fixed pragma directives in generator/src/main.cpp. Generator now builds successfully on both Clang and GCC."}
{"id":"canopy-mno","title":"Address thread safety and race conditions","description":"DECOMPOSED into specific issues - see below.\n\nThis epic has been broken down into 14 actionable issues:\n\nHIGH Priority Fixes (P1):\n- canopy-o05: Fix TCP Transport keep_alive_ shared pointer access\n- canopy-g4h: Fix pending transmits shutdown race\n- canopy-v5y: Fix service proxy map operation races\n\nMEDIUM Priority Verifications (P2):\n- canopy-o35: Review transport destination management performance\n- canopy-6gj: Verify TCP transport send queue lock scope\n- canopy-90a: Fix TCP transport shutdown_event_ access\n- canopy-qcp: Verify SPSC transport send queue lock scope\n- canopy-7i3: Verify object proxy reference counting\n- canopy-9ex: Verify service proxy version negotiation\n- canopy-7t9: Verify thread-local logger circular buffer\n- canopy-498: Verify concurrent transport access in service\n- canopy-8eb: Verify service proxy management in service\n\nAudit \u0026 Testing (P1):\n- canopy-bv1: Perform memory ordering audit for all atomics (depends on HIGH fixes)\n- canopy-o9y: ThreadSanitizer testing and stress tests (depends on audit)\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md Section 2.1","status":"closed","priority":0,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":960,"created_at":"2026-01-12T14:28:02.561091421Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.524584057Z","closed_at":"2026-01-12T14:42:32.436037249Z","close_reason":"Decomposed into 14 specific actionable issues for better tracking and parallel work","labels":["concurrency","critical","safety"]}
{"id":"canopy-nq8","title":"Add zones{} and adjacencyList data structures","description":"# Task: Add Data Structures for Tree Layout\n\n## What\nAdd zones object and adjacencyList Set alongside existing nodes/links Maps\n\n## Where  \ntelemetry/src/animation_telemetry_service.cpp line ~382\n\n## Current Code\n```javascript\nconst nodes = new Map();\nconst links = new Map();\nconst zoneLayout = new Map();\n```\n\n## New Code\n```javascript  \nconst nodes = new Map();\nconst links = new Map();\nconst zoneLayout = new Map();\n\n// NEW: Tree layout structures\nconst zones = {};  // zone_id -\u003e { id, name, parentId, transports[], passthroughs[], children[] }\nconst adjacencyList = {};  // zone_id -\u003e Set of adjacent zone_ids\n```\n\n## Why\n- test.html uses zones{} to build hierarchy\n- adjacencyList needed for BFS pathfinding in passthroughs\n- Separate from nodes Map which includes proxies, stubs, etc\n\n## Dependencies\nNone - this is foundational\n\n## Test\nAfter adding, verify file still compiles:\n```bash\ncmake --build build_debug --target rpc_telemetry\n```","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:36:34.421936982Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T23:04:28.067442398Z","closed_at":"2026-01-20T23:04:28.067442398Z","close_reason":"Closed"}
{"id":"canopy-o05","title":"Fix TCP Transport keep_alive_ shared pointer access","description":"Location: /transports/tcp/transport.cpp:463 - pump_messages() loop\n\nIssue: keep_alive_ shared_ptr accessed in loop condition without synchronization. Multiple coroutines might modify causing undefined behavior.\n\nFix options:\n1. Use std::atomic\u003cstd::shared_ptr\u003cT\u003e\u003e (C++20)\n2. Mutex-protected access\n3. Load once before loop and use local copy\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.2","status":"closed","priority":1,"issue_type":"bug","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:31.397819265Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.519971928Z","closed_at":"2026-01-12T14:59:50.470563953Z","close_reason":"Fixed by adding internal synchronization to member_ptr class.\n\nImplementation:\n- Added std::shared_mutex to both stdex::member_ptr and rpc::member_ptr\n- get_nullable(): Uses std::shared_lock for concurrent read access\n- reset() and assignment operators: Use std::unique_lock for exclusive write access\n- Copy/move assignment: Use std::scoped_lock to prevent deadlock when locking both mutexes\n\nThread-Safety Guarantees:\n- Multiple threads can call get_nullable() concurrently (reader-writer lock)\n- Writes (reset, assignment) have exclusive access and block all reads\n- No external synchronization required - member_ptr handles it internally\n\nDesign Philosophy:\nmember_ptr forces threads to extract a local copy via get_nullable(), which prevents race conditions on the member variable itself. The internal shared_mutex ensures thread-safe access to the underlying shared_ptr, while the shared_ptr's reference counting provides thread-safe lifetime management.\n\nFiles Modified:\n- rpc/include/rpc/internal/member_ptr.h\n\nDocumentation:\n- Added comprehensive Doxygen comments explaining thread-safety guarantees\n- Included usage examples for both stdex::member_ptr and rpc::member_ptr\n- Documented the design rationale"}
{"id":"canopy-o35","title":"Review transport destination management performance","description":"Location: /rpc/src/transport.cpp:249-298 - create_pass_through()\n\nStatus: Deadlock prevention already implemented via consistent lock ordering (zone ID order).\n\nTask: Performance review of coarse-grained locking on nested map pass_thoughs_. Consider finer-grained locking if profiling shows contention.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.2","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:31.620015815Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.525155245Z"}
{"id":"canopy-o9y","title":"ThreadSanitizer testing and stress tests","description":"Phase 4 of thread safety work - comprehensive testing with race detection tools.\n\nTasks:\n1. Build with ThreadSanitizer: cmake --preset Debug -DCMAKE_CXX_FLAGS=\"-fsanitize=thread -g\"\n2. Run all tests under ThreadSanitizer\n3. Run Helgrind (valgrind --tool=helgrind) for additional verification\n4. Create stress tests with 100+ concurrent zones\n5. Test rapid connection/disconnection cycles\n6. Test simultaneous shutdown from multiple threads\n7. Fix any races discovered during testing\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.6\n\nSuccess criteria:\n- Zero TSan violations\n- Zero Helgrind violations\n- Stress tests pass consistently","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":1920,"created_at":"2026-01-12T14:41:45.504991505Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.51829754Z","dependencies":[{"issue_id":"canopy-o9y","depends_on_id":"canopy-bv1","type":"blocks","created_at":"2026-01-12T14:41:58.628019435Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-p8k","title":"Replace D3 force simulation with tree layout initialization","description":"# Task: Replace Force Simulation with Tree Layout\n\n## What\nReplace D3 force simulation setup with tree layout\n\n## Where\nLines ~709-786 (SVG setup and force simulation)\n\n## Current Code (DELETE)\n```javascript\nconst simulation = d3.forceSimulation()\n    .alphaDecay(0.02)\n    .velocityDecay(0.8)\n    .force('link', d3.forceLink()...)\n    .force('charge', d3.forceManyBody()...)\n    // etc\n```\n\n## New Code (ADD)\n```javascript\nconst vizContainer = d3.select('#viz-container');\n\nconst svgRoot = vizContainer\n    .append('svg')\n    .attr('class', 'telemetry-svg');\n\nfunction resizeSvg() {\n    const node = vizContainer.node();\n    if (!node) return;\n    const bounds = node.getBoundingClientRect();\n    canvasWidth = Math.max(bounds.width, 640);\n    canvasHeight = Math.max(bounds.height, 480);\n    svgRoot\n        .attr('width', canvasWidth)\n        .attr('height', canvasHeight);\n}\n\nconst g = svgRoot.append('g');  // Main container\n\n// Zoom behavior\nsvgRoot.call(d3.zoom()\n    .on('zoom', (event) =\u003e {\n        g.attr('transform', event.transform);\n    }));\n\nresizeSvg();\nwindow.addEventListener('resize', () =\u003e {\n    resizeSvg();\n    rebuildVisualization();  // Rebuild tree on resize\n});\n```\n\n## Key Changes\n- Remove force simulation completely\n- Keep zoom behavior (both use it)\n- Remove linkLayer/nodeLayer - tree renders differently\n- Add rebuildVisualization() call on resize\n\n## Dependencies\n- Depends on zones{} being populated\n- Requires rebuildVisualization() function (next task)\n\n## Test\nAfter change:\n1. Verify SVG renders\n2. Zoom should still work\n3. No force simulation running in background","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-20T22:37:38.371338057Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T12:03:39.557137586Z","closed_at":"2026-01-21T12:03:39.557137586Z","close_reason":"Tree layout implementation complete. Visualization now uses hierarchical tree layout with port registry, trunk lines, and SVG viewBox coordinate system."}
{"id":"canopy-pwy","title":"Enhance i_telemetry_service add_ref/release options to match i_marshaller","description":"Update /home/edward/projects/Canopy/telemetry/include/rpc/telemetry/i_telemetry_service.h so all *add_ref and *release methods include the additional options or reference counting issues present in /home/edward/projects/Canopy/rpc/include/rpc/internal/marshaller.h. Ensure i_telemetry_service parity with i_marshaller behavior and semantics.","acceptance_criteria":"i_telemetry_service add_ref/release signatures align with i_marshaller reference counting options; behavior parity verified; no regressions in telemetry interfaces.","status":"closed","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T14:14:37.504712236Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T14:57:05.87307776Z","closed_at":"2026-01-21T14:57:05.87307776Z","close_reason":"Closed"}
{"id":"canopy-qcp","title":"Verify SPSC transport send queue lock scope","description":"Location: /transports/spsc/transport.cpp\n\nIssue: Similar to TCP - lock acquired, released, queue accessed again.\n\nTask: Ensure atomic queue operations or proper lock scope throughout.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.3","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":240,"created_at":"2026-01-12T14:41:32.070969221Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.525461402Z"}
{"id":"canopy-r7j","title":"Implement click to highlight related nodes","description":"Add interactive node selection with path highlighting.\n\nClick behaviors:\n- Zone: highlight all nodes within it\n- Proxy: highlight routing path (proxy → transport → stub)\n- Transport: highlight both endpoints and connected zones\n- Passthrough: highlight forward/reverse routing paths\n\nVisual: glow effect, thicker borders, or color change\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nReference: visualiser.md section 3","status":"open","priority":3,"issue_type":"feature","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:46:38.598302731Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T11:59:34.453750869Z"}
{"id":"canopy-rjt","title":"Enhance SGX enclave transport with bi-modal support","description":"Implement bi-modal hierarchical transport for secure enclave zones (SGX, TrustZone).\n\nStatus: PLANNED - ENHANCEMENT TO EXISTING SGX TRANSPORT\n\nCurrent State:\n- Existing SGX transport likely synchronous-only\n- Needs enhancement for full bi-modal support\n- Needs better integration with transport base class\n\nRequirements:\n- Bi-modal support (synchronous and asynchronous modes)\n- Synchronous: Blocking ECALL/OCALL semantics\n- Asynchronous: Async ECALL/OCALL with coroutine suspension\n- Scheduler options: shared or dedicated (dedicated recommended for security)\n- Hierarchical architecture (untrusted ↔ enclave)\n\nSecurity Considerations:\n- All data crossing enclave boundary must be serialized\n- No raw pointer passing across boundary\n- Careful scheduler state management (trust boundary)\n\nImplementation Tasks (6-8 weeks):\nWeek 1-2: Analyze current SGX transport\nWeek 3-4: Implement bi-modal ECALL/OCALL\nWeek 4-5: Scheduler integration\nWeek 5-6: Multi-level hierarchy support\nWeek 7: ARM TrustZone support (optional)\nWeek 8: Documentation and security review\n\nReference: docs/to_do/Enhanced_Enclave_Transport.md\nDependencies: DLL transport (for similar pattern reference)","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":1600,"created_at":"2026-01-12T14:28:02.329530429Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.521746626Z","labels":["enclave","security","sgx","transport"],"dependencies":[{"issue_id":"canopy-rjt","depends_on_id":"canopy-f7o","type":"blocks","created_at":"2026-01-12T14:29:35.269431374Z","created_by":"Edward Boggis-Rolfe"}]}
{"id":"canopy-s4t","title":"Review and audit all error code handling","description":"Comprehensive review of error code handling throughout the codebase to ensure consistency and correctness.\n\nScope:\n- Review all error::* constants and their usage\n- Verify error codes are properly propagated through call chains\n- Check that error conditions have appropriate error codes\n- Ensure error handling is consistent across transport implementations\n- Validate error code handling in coroutine and blocking paths\n- Review error codes in stub.cpp, service.cpp, transport.cpp, and proxy implementations\n- Check for places where errors might be silently ignored or improperly handled\n\nAreas to focus on:\n1. Transport layer error handling (connection failures, serialization errors)\n2. Reference counting error paths\n3. Zone boundary crossing error conditions\n4. Passthrough routing error handling\n5. Service lifecycle error conditions\n\nAcceptance criteria:\n- Document all error codes and their meanings\n- Ensure all error paths return appropriate error codes\n- Add missing error handling where needed\n- Consider adding error code tests","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-27T19:28:10.354356898Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-27T19:28:10.354356898Z"}
{"id":"canopy-tea","title":"Formalize IDL type system with explicit types","description":"Formalize the RPC++ IDL type system with explicit type definitions, eliminating platform ambiguity.\n\nStatus: PLANNED - HIGH IMPACT FOUNDATIONAL WORK\n\nCurrent Problem:\n- Types like int, long, size_t have platform-dependent sizes\n- Poor type safety in generators (string-based type parsing)\n- Limited metaprogramming capabilities\n- Unclear RPC semantics (value vs handle types)\n\nProposed Solution:\n- Add explicit types: i8, i16, i32, i64, u8, u16, u32, u64, f32, f64\n- Add string, bytes collection types\n- Add vector\u003cT\u003e, array\u003cT,N\u003e, map\u003cK,V\u003e, optional\u003cT\u003e\n- Add shared_handle\u003cT\u003e, optimistic_handle\u003cT\u003e for RPC semantics\n\nImplementation Phases:\nPhase 1: AST Enhancement (2-3 weeks)\nPhase 2: Code Generator Updates (3-4 weeks)\nPhase 3: Migration and Compatibility (2-3 weeks)\nPhase 4: Validation and Tooling (2 weeks)\n\nReference: docs/to_do/IDL_Type_System_Formalization.md\nLocations: submodules/idlparser/, generator/src/","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":2400,"created_at":"2026-01-12T14:28:02.080870716Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.525757721Z","labels":["foundational","idl","parser","type-system"]}
{"id":"canopy-uwp","title":"Enable click event in log to seek timeline","description":"Make event log interactive for timeline navigation.\n\nFeatures:\n- Click any event in log panel to jump to that timestamp\n- Highlight clicked event\n- Auto-scroll timeline slider to position\n- Pause playback if currently playing\n\nFiles: telemetry/src/animation_telemetry_service.cpp\nReference: visualiser.md section 4","status":"open","priority":3,"issue_type":"feature","owner":"edward@boggis-rolfe.com","created_at":"2026-01-21T11:46:45.313895107Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T11:59:34.476508071Z"}
{"id":"canopy-v5y","title":"Fix service proxy map operation races","description":"Location: /rpc/src/service_proxy.cpp\n\nIssue: proxies_ map operations in on_object_proxy_released() and get_or_create_object_proxy() may have races between creation, release, and cleanup.\n\nFix: Ensure consistent locking pattern (lock → check → operate → unlock). Avoid unlocking and re-locking within single logical operation.\n\nReference: CODE_QUALITY_REVIEW.md Section 2.1.2","status":"open","priority":1,"issue_type":"bug","owner":"edward@boggis-rolfe.com","estimated_minutes":360,"created_at":"2026-01-12T14:41:31.721557621Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.519275344Z"}
{"id":"canopy-v64","title":"Add comprehensive public API documentation","description":"Add comprehensive Doxygen-style API documentation for all public headers.\n\nStatus: PLANNED\n\nCurrent State: Sparse comments in public headers\n\nTarget Files:\n- rpc/include/rpc/rpc.h - Main public API\n- rpc/include/rpc/internal/service.h - Service interface\n- rpc/include/rpc/internal/marshaller.h - Marshalling interface\n- All other public headers\n\nRequired Documentation:\n- Function purpose and behavior\n- Parameter descriptions\n- Return value semantics\n- Thread-safety guarantees\n- Exception specifications\n- Usage examples\n- Pre/post-conditions\n\nBenefits:\n- Easier for developers to use the library\n- Better understanding of API contracts\n- Foundation for auto-generated documentation\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md (Section 5.1)","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":640,"created_at":"2026-01-12T14:28:36.550506377Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.516514407Z","labels":["api","documentation"]}
{"id":"canopy-w6l","title":"Fix telemetry ref counting for relay operations","description":"## Problem\n\nTelemetry animation shows false positive error: \"transport transport-1-to-2 shared count went negative\"\n\n## Root Cause\n\nIn `animation.js` line 1300-1303, relay add_ref operations (options=3) are skipped from ref counting:\n\n```javascript\nif (isAdd \u0026\u0026 options === 3) {\n    pulseRelayActivity(evt, zoneNumber, adjacentNumber, 'transport');\n    return;  // Skip counting\n}\n```\n\nHowever, relay release operations are NOT skipped, causing the ref count to go negative.\n\n## Understanding Relay Operations (options=3)\n\n### What is options=3?\n\nIn `rpc/interfaces/rpc/rpc_types.idl`, option value 3 is the combination of:\n- `build_destination_route` (bit 0)\n- `build_caller_route` (bit 1)\n\nWhen both flags are set, we have a **relay operation**.\n\n### Relay Operation Scenario\n\n**Topology:**\n```\nZone 1 ←→ Zone 2\n           ↓\n        ┌──┴──┐\n     Zone 3  Zone 4\n```\n\n**Scenario:**\n- Object lives in Zone 3\n- Zone 1 has `shared_ptr` to that object (via Zone 2)\n- Zone 1 wants to share that reference with Zone 4\n\n**Relay Process:**\n\n1. **Zone 1 → Zone 2**: add_ref with `options=3`\n   - This is a **control message** (relay instruction), NOT an actual reference\n   - Zone 2 should NOT increment ref count between Zone 1 and Zone 2\n   - It's telling Zone 2: \"Establish a reference from Zone 4 to Zone 3\"\n\n2. **Zone 2 acts as relay**:\n   - Checks if passthrough exists for Zone 3 ↔ Zone 4\n   - If NO: Create passthrough with `shared_count=1`\n   - If YES: Increment passthrough `shared_count`\n   - Routes: Zone 4 calls → passthrough → Zone 3\n\n3. **Result**: Zone 4 now has a reference to the object in Zone 3\n\n4. **When Zone 4 releases**:\n   - Release goes through Zone 2's passthrough\n   - Passthrough decrements `shared_count`\n   - If `shared_count==0`: Delete passthrough\n\n### Why Transport Ref Counts Shouldn't Change\n\nThe relay operation (options=3) doesn't represent Zone 1 holding a reference through Zone 2 to Zone 3. It's Zone 1 instructing Zone 2 to wire up a reference **between Zone 4 and Zone 3**.\n\n**Transport ref counts** track proxies/stubs between adjacent zones.\n**Passthrough ref counts** track references between non-adjacent zones routed through intermediary.\n\nRelay operations create/modify passthroughs, not transport references.\n\n## Solution\n\nSkip BOTH relay add_ref and relay release operations (options=3) from transport ref counting:\n\n```javascript\n// Skip relay operations (options=3) for both add_ref and release\nif (options === 3) {\n    if (isAdd) {\n        pulseRelayActivity(evt, zoneNumber, adjacentNumber, 'transport');\n    }\n    return;\n}\n```\n\nThis maintains the balance: relay operations don't affect transport ref counts, they affect passthrough ref counts.\n\n## Files to Modify\n\n- `telemetry/html_templates/animation/animation.js` - Update updateTransportRefCounts() function (already fixed)\n\n## Testing\n\n- Verify with test reports like `remote_type_test#0/check_for_interface_storage.html`\n- Ensure no false \"went negative\" errors for relay operations\n- Verify normal (non-relay) ref counting still works correctly\n- Verify passthrough ref counts are tracked separately\n\n## Related\n\n- See `documents/architecture/passthroughs.md` for passthrough lifecycle documentation\n- Relay operations enable transparent multi-zone routing without direct connections","status":"open","priority":2,"issue_type":"bug","owner":"edward@boggis-rolfe.com","created_at":"2026-01-23T17:38:45.688352748Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-23T19:05:08.106076827Z"}
{"id":"canopy-y7n","title":"transport::inbound_add_ref Reference Counting Bug","description":"## Issue: transport::inbound_add_ref Reference Counting Bug\n\n### Problem\nThe transport::inbound_add_ref method has a bug where it doesn't properly increment transport reference counts or notify passthrough, causing incorrect internal state tracking.\n\n### Root Cause Analysis\n1. Same-zone operations: When forward_transport-\u003einbound_add_ref() is called with forward_dest (same zone), the transport's add_ref_count should increment but doesn't\n2. Passthrough notification failure: Passthrough's add_ref method isn't being called when it should be for cross-zone operations\n3. Complex reference counting rules: Missing logic for different add_ref_options scenarios\n\n### Reference Counting Rules Found\n- If caller_or_destination == service_zone_id: Increment add_ref_count (local service-to-transport)\n- If add_ref_options::normal OR add_ref_options::optimistic: Increment add_ref_count AND notify passthrough\n- If build_caller_route XOR build_dest_channel: Increment add_ref_count AND notify passthrough  \n- If build_caller_route \u0026\u0026 build_destination_route: Do NOT increment reference counts (back-channel only)\n\n### Release Counting Rules (Simpler)\n- All releases go through passthrough if not involving local service\n- No transformation of routing context\n\n### Race Condition Warning\nThere's a potential race condition when two threads add the same source/destination pair - needs synchronization protection.\n\n### Fix Plan\n1. Implement correct reference counting logic in transport::inbound_add_ref\n2. Add proper passthrough notification with synchronization\n3. Apply same logic to transport::inbound_release\n4. Handle edge cases and race conditions\n\n### Affected Tests\n- add_ref_optimistic - expecting add_ref_count to be 1, getting 0\n- release_happy_path - expecting release_count to be 1, getting 0  \n- reference_count_balance - expecting send_count to be 2, getting 0\n\nPlease track this issue as high priority for transport layer fixes.","status":"closed","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","created_at":"2026-01-12T23:11:44.832234875Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.523450409Z","closed_at":"2026-01-17T20:25:17.614839213Z","close_reason":"Closed"}
{"id":"canopy-y7o","title":"Implement reference counting tracking in i_telemetry_service","description":"Implement comprehensive reference counting tracking in i_telemetry_service to capture all add_ref and release events with their parameters.\n\n## Problem\nCurrent telemetry provides limited visibility into reference counting operations. We cannot trace:\n- Which add_ref/release events are happening\n- What options parameters are passed (add_ref_options, release_options)\n- The state of shared_count_ and optimistic_count_ atomics\n- Cross-zone reference counting patterns\n\n## Requirements\n\n### 1. Telemetry Events\nAdd new telemetry event types:\n- `add_ref_send` - When add_ref is sent across transport\n- `add_ref_received` - When add_ref is received inbound\n- `add_ref_local` - When add_ref is local (same zone)\n- `release_send` - When release is sent across transport\n- `release_received` - When release is received inbound\n- `release_local` - When release is local (same zone)\n\n### 2. Event Payload\nEach event should capture:\n```cpp\nstruct ref_count_event {\n    uint64_t object_id;\n    uint32_t zone_id;\n    uint32_t remote_zone_id;  // 0 if local\n    bool is_optimistic;       // true for optimistic_ptr, false for shared_ptr\n    uint32_t previous_count;  // Count before operation\n    uint32_t new_count;       // Count after operation\n    add_ref_options_t options;      // If add_ref\n    release_options_t options;       // If release\n    bool is_local;            // true if same zone operation\n    bool build_caller_route;  // From routing context\n    bool build_dest_channel;  // From routing context\n    transport_type_t transport_type; // TCP, SPSC, PassThrough, etc.\n};\n```\n\n### 3. Visualization Integration\nUpdate animation_telemetry_service.cpp:\n- Track ref_count_events[] alongside existing telemetry events\n- Show reference count bubbles on object proxies and stubs\n- Color-code: green for shared_ptr, orange for optimistic_ptr\n- Animate count changes with +/- indicators\n- Display count in tooltip on hover\n- Show cross-zone reference tracking with dashed lines\n\n### 4. Benefits\n- Debug reference counting issues (canopy-7i3)\n- Visualize reference lifecycle across zones\n- Detect reference leaks (objects never released)\n- Debug race conditions in add_ref/release sequencing\n- Verify transport failure cleanup (canopy-bq5)\n\n## Implementation Tasks\n\n### Phase 1: Core Infrastructure (Week 1)\n- Define ref_count_event struct in telemetry headers\n- Add telemetry callback in i_telemetry_service.idl\n- Implement event capture in transport::inbound_add_ref/inbound_release\n- Add event capture in object_proxy::add_ref/object_proxy::release\n\n### Phase 2: Event Processing (Week 2)\n- Update animation_telemetry_service.cpp to handle new events\n- Store ref_count_events[] array (separate from nodes/links)\n- Update ensureZoneNode() and related functions\n- Add visualization rendering for reference counts\n\n### Phase 3: Visualization (Week 2-3)\n- Render count bubbles on proxy/stub nodes\n- Implement hover tooltips showing count history\n- Add cross-zone reference tracking lines\n- Color coding and animations\n\n### Phase 4: Testing (Week 3)\n- Test with existing reference counting tests\n- Verify no performance impact on production code\n- Test visualization with multi-zone scenarios\n\n## Files to Modify\n- telemetry/include/rpc/telemetry/... (new event structures)\n- telemetry/src/animation_telemetry_service.cpp\n- rpc/src/object_proxy.cpp (add telemetry callbacks)\n- rpc/src/transport.cpp (add telemetry callbacks)\n- i_telemetry_service.idl (add new event type)\n\n## Related Issues\n- canopy-7i3: Verify object proxy reference counting\n- canopy-bq5: Implement transport failure detection\n- canopy-g4h: Fix pending transmits shutdown race\n\n## Success Criteria\n- All add_ref/release events captured in telemetry\n- Visualization shows current reference counts on all proxies/stubs\n- Cross-zone reference relationships visible\n- Tooltip shows detailed event history per object","status":"open","priority":2,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":960,"created_at":"2026-01-21T13:01:00Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-21T13:01:00Z","labels":["debugging","reference-counting","telemetry","visualization"]}
{"id":"canopy-zw9","title":"Document and mitigate deadlock risks","description":"Eliminate deadlock risks through architectural improvements and documentation.\n\nStatus: PLANNED - Partially addressed in thread safety analysis\n\nCurrent State:\n- service.cpp contains explicit warnings about deadlock risks\n- Uses scoped blocks to manage lock lifetimes (fragile approach)\n- Complex interactions between stub_control_ and zone_control_ mutexes\n- Transport destination management already implements deadlock prevention via lock ordering\n\nProposed Actions:\n1. Review and document all mutex acquisition patterns\n2. Analyze stub_control_ and zone_control_ lock interactions\n3. Consider lock hierarchy to prevent circular dependencies\n4. Evaluate alternative concurrency models (e.g., actor model for internal state management)\n5. Reduce scope of critical sections where possible\n6. Document lock ordering policies\n\nRisk Assessment: High priority due to potential runtime failures\n\nBenefits:\n- Prevent runtime deadlocks\n- More maintainable concurrent code\n- Better understanding of concurrency patterns\n\nReference: docs/to_do/CODE_QUALITY_REVIEW.md (Section 2.2)\nRelated: canopy-mno (thread safety and race conditions)","status":"open","priority":1,"issue_type":"task","owner":"edward@boggis-rolfe.com","estimated_minutes":960,"created_at":"2026-01-12T14:28:36.746667761Z","created_by":"Edward Boggis-Rolfe","updated_at":"2026-01-20T14:27:22.520325084Z","labels":["architecture","concurrency","safety"],"dependencies":[{"issue_id":"canopy-zw9","depends_on_id":"canopy-mno","type":"blocks","created_at":"2026-01-12T14:29:35.29221463Z","created_by":"Edward Boggis-Rolfe"}]}
